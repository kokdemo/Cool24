<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="description" content="24点游戏">
    <meta name="author" content="@kokdemo">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no">
    <title>Cool24</title>
    <!-- <link rel="stylesheet" type="text/css" href="css/main_new.css" /> -->
    <link href="http://cdn.bootcss.com/bootstrap/4.0.0-alpha.3/css/bootstrap.css" rel="stylesheet">
    <style>

    </style>
    <script type="text/javascript" src="js/vue.js"></script>
</head>

<body>
    <div class='start container-fluid text-xs-center'>
        <h1 class="center-block">Cool24</h1>
        <span>数字游戏，提神醒脑</span>
    </div>
    <div class='game container-fluid text-xs-center'>
        <div class='info'>
            <span class='score'></span>
            <span class='highest-score'></span>
        </div>
        <div class='timer'>
            <span class='time'></span>
        </div>
        <div class='numbers'>
            <button class='number btn' v-for='(index,item) in numbers' track-by="$index" v-text='item.number' v-show='!item.used' v-on:click='useNumber(item.number,index)' v-bind:class="{'available':item.available}"></button>
        </div>
        <div class='signals'>
            <button class='signal btn' v-for='item in signals' v-text='item' v-on:click='useSignals(item)'></button>
        </div>
        <div class="input">
            <input type="text" name="" id="" v-model='inputs'>
        </div>
        <div class="buttons">
            <button class="btn" v-on:click='submit(inputs,numbers)'>提交</button>
            <button class="btn" v-on:click='clear()'>清空</button>
            <button class="btn">求助</button>
        </div>
    </div>
    <div class='result container-fluid text-xs-center'>
        <span>你一共答对了x题，获得了x分，你此前最高分是x</span>
        <div class="buttons">
            <button class="btn">再来一局</button>
        </div>
    </div>
    <script>
    function temp4(a,b) {
        return(
            [a+b,a-b,b-a,a*b,a/b,b/a]
        )
    }
    var deepCopy = function(o) {
        if (o instanceof Array) {
            var n = [];
            for (var i = 0; i < o.length; ++i) {
                n[i] = deepCopy(o[i]);
            }
            return n;

        } else if (o instanceof Object) {
            var n = {}
            for (var i in o) {
                n[i] = deepCopy(o[i]);
            }
            return n;
        } else {
            return o;
        }
    }
    var is24 = function(number) {
        var origin = deepCopy(number);
        for (var i = 0; i < origin.length; i++) {
            var a = origin[i];
            origin.splice(i,1);
            for (var j = 0; j < origin.length; j++) {
                var b= origin[j];
                origin.splice(j,1);
                var temp = temp4(a,b);
                for (var k = 0; k < origin.length; k++) {
                    var c= origin[k];
                    origin.splice(j,1);
                    var d = origin[0];
                    var temp2 = [];
                    temp2 = temp2.concat(temp4(temp[0],c));
                    temp2 = temp2.concat(temp4(temp[1],c));
                    temp2 = temp2.concat(temp4(temp[2],c));
                    temp2 = temp2.concat(temp4(temp[3],c));
                    temp2 = temp2.concat(temp4(temp[4],c));
                    temp2 = temp2.concat(temp4(temp[5],c));
                    var temp3 =[];
                    for(var o=0;o<temp2.length;o++){
                        temp3 = temp3.concat(temp4(temp2[o],d));
                    }
                    for(var q=0;q<temp3.length;q++){
                        if(temp3[q]==24){
                            var signs = ['+','-','-','*','/','/']
                            var sign1 = Math.floor(q/36);
                            var sign2 = Math.floor(q%36/6);
                            var sign3 = q%6;
                            var strings = '';
                            if(sign1 == 2||sign1 ==5){
                                strings += '('+b+signs[sign1]+a+')';
                            }else{
                                strings += '('+a+signs[sign1]+b+')';
                            }
                            if(sign2 == 2||sign2 ==5){
                                strings = '('+c+signs[sign2]+strings+')';
                            }else{
                                strings = '('+strings+signs[sign2]+c+')';
                            }
                            if(sign3 == 2||sign3 ==5){
                                strings = d+signs[sign3]+strings;
                            }else{
                                strings = strings+signs[sign3]+d;
                            }
                            return(strings);
                        }
                    }
                }
            }
            origin = deepCopy(number);
        }
        return(false);
    }
    var firstNumbers = {};
    var get4Numbers = function(data){
        var numbers = [];
        for (var i = 3; i >= 0; i--) {
    		numbers.push(Math.floor(Math.random() * 10 + 1));
    	};
        var result = is24(numbers);
        if(result !== false){
            data.numbers = numbers;
            data.result = result;
            console.info(result);
            return({
                numbers:numbers,
                result:result
            });
        }else{
            get4Numbers(data);
        }
    }
    get4Numbers(firstNumbers);
    var cool = new Vue({
        el:'body',
        data:{
            numbers:[
                {number:firstNumbers.numbers[0],used:false,available:true},
                {number:firstNumbers.numbers[1],used:false,available:true},
                {number:firstNumbers.numbers[2],used:false,available:true},
                {number:firstNumbers.numbers[3],used:false,available:true}
            ],
            signals:['+','-','*','/','(',')'],
            time:0,
            score:0,
            highestScore:0,
            inputs:'',
            result:firstNumbers.result
        },
        compute:{

        },
        ready:function(){
        },
        methods:{
            useNumber:function (number,index) {
                this.$data.inputs += number;
                this.$data.numbers[index].used = true;
                for(var i=0;i<4;i++){
                    this.$data.numbers[i].available = false;
                }
            },
            useSignals:function (signal) {
                this.$data.inputs += ''+signal;
                for(var i=0;i<4;i++){
                    if(signal !== '(' && signal !== ')'){
                        this.$data.numbers[i].available = true;
                    }
                }
            },
            submit:function(inputs,numbers) {
                for(var i=0;i<4;i++){
                    if(!numbers[i].used){
                        console.info('not used all numbers')
                        return 0;
                    }
                }
                var reg = /[\u002b\u002d\u002a\u002f]{2,}/;
                if(reg.test(inputs)){
                    console.info('wrong signal')
                }else{
                    var result = eval(inputs);
                    if(result == 24){
                        console.info('right')
                    }else{
                        console.info('wrong')
                    }
                }
            },
            clear:function() {
                for(var i=0;i<4;i++){
                    this.$data.numbers[i].used = false;
                }
                this.$data.inputs = '';
                console.info('all clear')
            }
        }
    });
    </script>
</body>

</html>
